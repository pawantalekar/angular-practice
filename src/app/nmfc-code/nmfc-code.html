<div class="nmfc-container">
    <div class="input-wrapper" (click)="togglePopup()">
        <input type="text" [value]="selectedCode" placeholder="Select NMFC Code" readonly class="nmfc-input">
        <span class="search-icon">üîç</span>
    </div>

    <div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
        <div class="popup-content" (click)="$event.stopPropagation()">
            <div class="popup-header">
                <h3>Find NMFC Code</h3>
                <span class="close-btn" (click)="closePopup()">&times;</span>
            </div>
            <div class="popup-body">
                <p class="helper-text">Search by keyword or by selecting category and subcategory</p>

                <div class="filters">
                    <div class="search-box">
                        <label>Search</label>
                        <div class="input-group">
                            <input type="text" [(ngModel)]="searchTerm" placeholder="Search...">
                            <span class="clear-search" *ngIf="searchTerm" (click)="searchTerm = ''">&times;</span>
                        </div>
                    </div>
                    <div class="select-box">
                        <label>Category</label>
                        <select disabled>
                            <option>Select</option>
                        </select>
                    </div>
                    <div class="select-box">
                        <label>Subcategory</label>
                        <select disabled>
                            <option>Select</option>
                        </select>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <div class="col-code">NMFC Code</div>
                        <div class="col-desc">Description</div>
                        <div class="col-notes">Notes</div>
                        <div class="col-class">Class</div>
                        <div class="col-action">Action</div>
                    </div>
                    <div class="table-body">
                        <ng-container *ngFor="let group of groupedData">
                            <!-- Parent Row -->
                            <!-- If Single Item -->
                            <div class="table-row" *ngIf="group.items.length === 1">
                                <div class="col-code" style="padding-left: 24px;">
                                    <!-- Indent to align with text of expandable -->
                                    {{ group.items[0].code }}
                                </div>
                                <div class="col-desc">{{ group.items[0].description }}</div>
                                <div class="col-notes">{{ group.items[0].notes }}</div>
                                <div class="col-class">{{ group.items[0].class }}</div>
                                <div class="col-action">
                                    <button class="select-btn" (click)="selectItem(group.items[0])">
                                        <span class="check-icon">‚úì</span> Select
                                    </button>
                                </div>
                            </div>

                            <!-- If Multiple Items (Group Header) -->
                            <ng-container *ngIf="group.items.length > 1">
                                <div class="table-row group-header" [class.expanded]="group.expanded"
                                    (click)="toggleGroup(group)">
                                    <div class="col-code">
                                        <span class="arrow" [class.rotated]="group.expanded">‚Ä∫</span>
                                        {{ group.code }}
                                    </div>
                                    <div class="col-desc">{{ group.description }}</div>
                                    <div class="col-notes">‚Äî</div>
                                    <div class="col-class"></div> <!-- Empty for group header -->
                                    <div class="col-action">
                                        <!-- No select for group header -->
                                    </div>
                                </div>

                                <!-- Children -->
                                <ng-container *ngIf="group.expanded">
                                    <div class="table-row child-row" *ngFor="let item of group.items">
                                        <div class="col-code">{{ item.code }}</div>
                                        <div class="col-desc">{{ item.description }}</div>
                                        <div class="col-notes">{{ item.notes }}</div>
                                        <div class="col-class">{{ item.class }}</div>
                                        <div class="col-action">
                                            <button class="select-btn" (click)="selectItem(item)">
                                                <span class="check-icon">‚úì</span> Select
                                            </button>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>

                        </ng-container>
                    </div>
                </div>
            </div>

            <div class="popup-footer">
                <!-- Pagination or Footer buttons if needed -->
            </div>
        </div>
    </div>
</div>