<div class="nmfc-container">
    <div class="nmfc-row">
        <div class="input-wrapper description-wrapper">
            <input type="text" [value]="selectedDescription" placeholder="Description" readonly class="nmfc-input">
        </div>
        <div class="input-wrapper code-wrapper" (click)="togglePopup()">
            <input type="text" [value]="selectedCode" placeholder="Select NMFC Code" readonly class="nmfc-input">
            <span class="search-icon">üîç</span>
        </div>
    </div>

    <p-dialog [(visible)]="showPopup" [modal]="true" [closable]="true" [dismissableMask]="true" [draggable]="false"
        [resizable]="false" styleClass="nmfc-dialog" [style]="{ width: '900px', maxWidth: '95vw' }">

        <ng-template pTemplate="header">
            <h3 class="nmfc-header-title">Find NMFC Code</h3>
        </ng-template>

        <div class="popup-body">
            <p class="helper-text">Search by keyword or by selecting category and subcategory</p>

            <div class="filters">
                <div class="search-box">
                    <label>Search</label>
                    <div class="input-group">
                        <input type="text" pInputText [(ngModel)]="searchTerm" placeholder="Search...">
                        <span class="clear-search" *ngIf="searchTerm" (click)="searchTerm = ''">&times;</span>
                    </div>
                </div>
                <div class="select-box">
                    <label>Category</label>
                    <p-select [options]="[]" placeholder="Select" [disabled]="true"
                        styleClass="custom-dropdown"></p-select>
                </div>
                <div class="select-box">
                    <label>Subcategory</label>
                    <p-select [options]="[]" placeholder="Select" [disabled]="true"
                        styleClass="custom-dropdown"></p-select>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <div class="col-code">NMFC Code</div>
                    <div class="col-desc">Description</div>
                    <div class="col-notes">Notes</div>
                    <div class="col-class">Class</div>
                    <div class="col-action">Action</div>
                </div>
                <div class="table-body">
                    <ng-container *ngFor="let group of groupedData">
                        <div class="nmfc-group-wrapper">
                            <!-- If Single Item -->
                            <div class="table-row" *ngIf="group.items.length === 1">
                                <div class="col-code" style="padding-left: 24px;">
                                    {{ group.items[0].code }}
                                </div>
                                <div class="col-desc">{{ group.items[0].description }}</div>
                                <div class="col-notes">{{ group.items[0].notes }}</div>
                                <div class="col-class">{{ group.items[0].class }}</div>
                                <div class="col-action">
                                    <button class="select-btn" (click)="selectItem(group.items[0])">
                                        <span class="check-icon">‚úì</span> Select
                                    </button>
                                </div>
                            </div>

                            <!-- If Multiple Items (Group Header) -->
                            <ng-container *ngIf="group.items.length > 1">
                                <div class="table-row group-header" [class.expanded]="group.expanded"
                                    (click)="toggleGroup(group)">
                                    <div class="col-code">
                                        <span class="arrow" [class.rotated]="group.expanded">‚Ä∫</span>
                                        {{ group.code }}
                                    </div>
                                    <div class="col-desc">{{ group.description }}</div>
                                    <div class="col-notes">‚Äî</div>
                                    <div class="col-class"></div>
                                    <div class="col-action"></div>
                                </div>

                                <!-- Children -->
                                <ng-container *ngIf="group.expanded">
                                    <div class="table-row child-row" *ngFor="let item of group.items">
                                        <div class="col-code">{{ item.code }}</div>
                                        <div class="col-desc">{{ item.description }}</div>
                                        <div class="col-notes">{{ item.notes }}</div>
                                        <div class="col-class">{{ item.class }}</div>
                                        <div class="col-action">
                                            <button class="select-btn"
                                                (click)="selectItem(item); $event.stopPropagation()">
                                                <span class="check-icon">‚úì</span> Select
                                            </button>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </p-dialog>
</div>